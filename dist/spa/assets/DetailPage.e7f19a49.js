import{Q as z,a as oe}from"./QBreadcrumbs.2127a27e.js";import{ax as W,V as re,r as T,J as Y,aP as Z,aO as ee,ay as d,az as k,aF as O,f as c,aB as ae,k as le,C as ie,E as ce,c as G,h as j,l as N,g as ue,b2 as de,w as pe,b0 as ge,aL as fe,o as me,aH as Q,aA as v,b1 as H,F as J,aI as P,Q as S,aE as B,aJ as E,b3 as he,b4 as X}from"./index.ad2ba990.js";import{b as K,a as ve,Q as V}from"./QPageSticky.a2f5eeb9.js";import{Q as _e}from"./FileUpload.vue_vue_type_style_index_0_scoped_true_lang.e5af501b.js";import{u as te}from"./use-quasar.61617965.js";import"./axios.4f040f7f.js";import{_ as ne}from"./plugin-vue_export-helper.21dcd24c.js";import"https://esm.sh/octokit";const ye={style:{padding:"10px"}},be={__name:"FileUpload",props:{repo:{type:String,required:!0},branch:{type:String,default:"main"}},emits:["onSuccess"],setup(f,{emit:l}){const e=W(),_=te(),u=f,m=l;let n=re([]);const p=T(),y=T(!1),A=g=>{const i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});p.value.dispatchEvent(i)},F=async g=>{var q,U,C;y.value=!0;const i=new Date().getTime(),I=(U=(q=g.target.files)==null?void 0:q[0])==null?void 0:U.name.split("."),s=I==null?void 0:I[I.length-1],b={name:"myImg"+i+"."+s,file:(C=g.target.files)==null?void 0:C[0],id:i,status:"loading"};n.push(b);let x=await L(b.file);console.log(x),x.data?await R({base64File:x.data,fileName:b.name}):b.status="error",g.target.value="",y.value=!1},R=async({base64File:g,fileName:i})=>{var s,b,x,q;if(await octokit.request(`PUT /repos/${(s=e==null?void 0:e.gitUserInfo)==null?void 0:s.name}/${u.repo}/contents/img/${i}`,{owner:(b=e==null?void 0:e.gitUserInfo)==null?void 0:b.name,repo:u.repo,path:`/img/${i}`,branch:u.branch,message:`upload:${new Date().getTime()}`,committer:{name:(x=e==null?void 0:e.gitUserInfo)==null?void 0:x.name,email:((q=e==null?void 0:e.gitUserInfo)==null?void 0:q.email)||`${e==null?void 0:e.gitUserInfo.id}+${e==null?void 0:e.gitUserInfo.name}@users.noreply.github.com`},content:g,headers:{"X-GitHub-Api-Version":"2022-11-28"}})){let U=_.dialog({message:"\u4E0A\u4F20\u6210\u529F",position:"top"}),C=setTimeout(()=>{U.hide(),m("onSuccess","ok"),clearTimeout(C)},1e3)}y.value=!1},L=g=>new Promise((i,I)=>{let s=new FileReader;s.readAsDataURL(g),s.onload=()=>{console.log(s.result.split(",")[0]),i({data:s.result.split(",")[1]})},s.onerror=()=>{i({data:!1})}});return(g,i)=>Y((d(),k("div",ye,[O("input",{style:{display:"none"},type:"file",ref_key:"inputRef",ref:p,onChange:F},null,544),c(ae,{loading:y.value,color:"primary",label:"\u4E0A\u4F20\u6587\u4EF6",onClick:A},null,8,["loading"])],512)),[[Z,ee(e).canUpload]])}};var we=ne(be,[["__scopeId","data-v-aeb7ba4a"]]),De=le({name:"QBanner",props:{...ie,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(f,{slots:l}){const{proxy:{$q:e}}=ue(),_=ce(f,e),u=G(()=>"q-banner row items-center"+(f.dense===!0?" q-banner--dense":"")+(_.value===!0?" q-banner--dark q-dark":"")+(f.rounded===!0?" rounded-borders":"")),m=G(()=>`q-banner__actions row items-center justify-end col-${f.inlineActions===!0?"auto":"all"}`);return()=>{const n=[j("div",{class:"q-banner__avatar col-auto row items-center self-start"},N(l.avatar)),j("div",{class:"q-banner__content col text-body2"},N(l.default))],p=N(l.action);return p!==void 0&&n.push(j("div",{class:m.value},p)),j("div",{class:u.value+(f.inlineActions===!1&&p!==void 0?" q-banner--top-padding":""),role:"alert"},n)}}});const $e=["src"];Object.assign({name:"MyImg"},{__name:"MyImg",props:{baseSrc:{type:String}},setup(f){const e=de(f),_=T("");return pe(()=>e,(u,m)=>{u.baseSrc.value&&(console.log(m,u),fetch(u.baseSrc.value).then(n=>n.json()).then(n=>{_.value="data:image/jpeg;base64,"+n.content}))},{deep:!0,immediate:!0}),(u,m)=>(d(),k("div",null,[O("img",{style:{width:"30px",height:"30px"},src:_.value,alt:""},null,8,$e)]))}});const Ie=["onDragstart"],xe=["onClick"],ke=["onClick"],qe=["src"],Ce=["onClick"],Te={class:"box"},Ue=Object.assign({name:"DetialPage"},{__name:"DetailPage",setup(f){const l=te(),e=W(),_=ge(),u=fe(),m=T([]),n=T([""]),p=T(""),y=T(!1),A=()=>{const a=n.value.join("/");s(a)},F=a=>{a.type=="dir"&&(n.value=a.path.split("/"),s(a.path))},R=a=>{a.preventDefault(),console.log("drop",a);let o=JSON.parse(a.dataTransfer.getData("imgItem"));b(o.path,o.sha)},L=(a,o)=>{console.log(a,o),!y.value&&(y.value=!0,o.dataTransfer.setData("imgItem",JSON.stringify(a)))},g=()=>{y.value=!1},i=a=>{},I=a=>{},s=async a=>{l.loading.show({delay:400});const{id:o,owner:t,repo:r}=_.query;try{let w=await octokit.request(`GET /repos/${t}/${r}/contents/${a}`,{owner:t,repo:r,path:"",branch:"master",headers:{"X-GitHub-Api-Version":"2022-11-28"}});w.status==200&&(m.value=w.data.map(h=>{let D=h;if(h.type=="dir")D={...h,icons:"folder",type:"dir"};else if(h.type=="file"){const $=h.name.split("."),M=["png","webp","svg","png","jpg","jpeg","gif"];let se=$==null?void 0:$[($==null?void 0:$.length)-1];M.indexOf(se)!=-1?D={...h,icons:h.download_url,type:"img"}:D={...h,icons:"help",type:"unknow"}}else D={...h,icons:"help",type:"unknow"};return console.log(D),D})),l.loading.hide(),p.value=""}catch(w){l.loading.hide(),console.log(w),p.value=w}},b=async(a,o)=>{var D,$;const{id:t,owner:r,repo:w}=_.query;if((await octokit.request(`DELETE /repos/${r}/${w}/contents/${a}`,{owner:r,repo:w,path:a,message:"delete it",committer:{name:(D=e==null?void 0:e.gitUserInfo)==null?void 0:D.name,email:(($=e==null?void 0:e.gitUserInfo)==null?void 0:$.email)||`${e==null?void 0:e.gitUserInfo.id}+${e==null?void 0:e.gitUserInfo.name}@users.noreply.github.com`},sha:o,headers:{"X-GitHub-Api-Version":"2022-11-28"}})).status==200){x("\u5220\u9664\u6210\u529F");const M=n.value.join("/");s(M)}},x=a=>{let o=l.dialog({message:a,position:"top"}),t=setTimeout(()=>{o.hide(),clearTimeout(t)},1e3)},q=()=>{u.replace("/")},U=(a,o)=>{const t=n.value.slice(0,o+1),r=t.join("/");n.value=t,s(r)},C=a=>{const o=a.download_url;navigator.clipboard.writeText(o),l.dialog({message:"\u6587\u4EF6\u5730\u5740\u5DF2\u590D\u5236"})};return me(()=>{const a=n.value.join("/");s(a)}),(a,o)=>(d(),Q(_e,{class:"container"},{default:v(()=>[c(oe,{separator:" / ","active-color":"white",gutter:"none",class:"breadcrumbs"},{default:v(()=>[c(z,{icon:"home",onClick:q}),(d(!0),k(J,null,H(n.value,(t,r)=>(d(),Q(z,{label:t,key:r,onClick:w=>U(t,r)},null,8,["label","onClick"]))),128))]),_:1}),m.value.length>0?(d(),Q(K,{key:0,class:"flex file-box"},{default:v(()=>[(d(!0),k(J,null,H(m.value,t=>(d(),k("div",{class:"item-box",key:t==null?void 0:t.name,draggable:"true",onDragstart:r=>L(t,r),onDragend:g},[t.type=="dir"?(d(),k("div",{key:0,class:"item",style:{height:"fit-content"},onClick:r=>F(t,a.index)},[c(S,{style:{"font-size":"52px"},name:t.icons,color:"primary"},null,8,["name"]),c(V,{class:"label"},{default:v(()=>[B(E(t.name),1)]),_:2},1024)],8,xe)):P("",!0),t.type=="img"?(d(),k("div",{key:1,class:"item",style:{height:"fit-content"},onClick:r=>C(t)},[O("img",{draggable:!1,class:"img",src:t.icons,alt:""},null,8,qe),c(V,{class:"label"},{default:v(()=>[B(E(t.name),1)]),_:2},1024)],8,ke)):P("",!0),t.type=="unknow"?(d(),k("div",{key:2,class:"item",style:{height:"fit-content"},onClick:r=>C(t)},[c(S,{style:{"font-size":"52px"},name:t.icons,color:"grey"},null,8,["name"]),c(V,{class:"label"},{default:v(()=>[B(E(t.name),1)]),_:2},1024)],8,Ce)):P("",!0)],40,Ie))),128))]),_:1})):P("",!0),p.value?(d(),Q(K,{key:1,class:"flex justify-center align-center"},{default:v(()=>[c(De,{dense:"",class:he(ee(l).dark.isActive?"bg-grey-9":"bg-grey-2")},{avatar:v(()=>[c(S,{name:"signal_wifi_off",color:"primary"})]),default:v(()=>[B(" err:"+E(p.value),1)]),_:1},8,["class"])]),_:1})):P("",!0),O("div",Te,[c(we,{onOnSuccess:A,repo:a.$route.query.repo},null,8,["repo"])]),Y(c(ve,{position:"top-right",offset:[48,48]},{default:v(()=>[c(ae,{round:"",color:"red",icon:"delete",onDrop:R,onDragenter:X(I,["prevent"]),onDragover:X(i,["prevent"])})]),_:1},512),[[Z,y.value]])]),_:1}))}});var Re=ne(Ue,[["__scopeId","data-v-702b8f64"]]);export{Re as default};
